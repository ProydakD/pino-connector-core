# Настройки

[English](../en/configuration.md) | Русский

createConnector принимает объект конфигурации, который можно передать сразу или позже через connector.updateConfig(). Незаполненные поля получают значения по умолчанию.

## Общая структура

```ts
// Основной интерфейс конфигурации для коннектора
interface ConnectorConfigInput {
  // Минимальный уровень логов для обработки.
  level?: LogLevelName;
  // Массив транспортов для регистрации при запуске.
  transports?: TransportRegistration[];
  // Массив плагинов (хуков) для регистрации.
  plugins?: PluginRegistration[];
  // Карта сериализаторов для ретуширования или изменения полей логов.
  serializers?: SerializerMap;
  // Конфигурация для асинхронного контекста.
  context?: ConnectorContextConfigInput;
  // Конфигурация для внутреннего логгера диагностики.
  diagnostics?: ConnectorDiagnosticsConfigInput;
}
```

### level

- Значение по умолчанию: info
- Поддерживает уровни Pino (silent, fatal, error, warn, info, debug, trace)
- Меняется во время работы через connector.setLevel()

### transports

Список стартовых транспортов. Каждый объект обязан иметь name и config. Поле level задаёт минимальный уровень для конкретного транспорта. Дополнительные транспорты можно добавить или удалить через методы коннектора.

### plugins

Хуки до/после публикации. enabled: false оставляет запись в конфигурации, но исключает выполнение. Подробности в [plugins.md](plugins.md).

### serializers

Карта обработчиков по ключам записи. Каждый сериалайзер может редактировать или заменять значение до отправки в транспорт. Подробнее в [serializers.md](serializers.md).

### context

Управляет работой AsyncLocalStorage:

- initial: базовый объект, доступный всем логгерам
- propagateAsync: по умолчанию true. Отключите, если требуется ручное управление контекстом.

### diagnostics

Включает или отключает внутренний логгер диагностики. Даже при выключенном самологгере снимок connector.getDiagnosticsSnapshot() остаётся доступным.

## Обновление конфигурации

```ts
// Вы можете обновить конфигурацию во время выполнения.
connector.updateConfig({
  // Изменить уровень логов на "debug".
  level: "debug",
  // Заменить существующие плагины новым массивом.
  plugins: [...],
});
```

Обновляются только переданные поля. Уже зарегистрированные транспорты продолжают работать, пока вы их явно не удалите.

## Ошибки валидации

InvalidConnectorConfigError возникает, если:

- Конфигурация не является plain-object
- У транспорта отсутствует name или config
- У плагина нет функции hook
- В карте сериалайзеров встречаются значения, не являющиеся функциями

Рекомендуется перехватывать ошибку в адаптерах и показывать пользователям понятные сообщения.
