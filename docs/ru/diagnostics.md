# Диагностика

[English](../en/diagnostics.md) | Русский

Диагностика помогает отслеживать состояние транспортов и поведение плагинов без засорения пользовательских логов.

## Самологгер

```ts
// Вы можете предоставить пользовательский логгер для внутренней диагностики коннектора.
const connector = createConnector({
  selfLogger: {
    info: console.log, // Использовать console.log для информационных сообщений
    warn: console.warn, // Использовать console.warn для предупреждений
    error: console.error, // Использовать console.error для ошибок
  },
});
```

Если логгер не передан, используется корневой Pino с защитой от рекурсии.

## Снимки состояния

```ts
// Получить снимок текущей диагностики.
const snapshot = connector.getDiagnosticsSnapshot();

// Затем вы можете проверить состояние транспортов.
console.log(snapshot.transports);
```

Снимок содержит состояние коннектора, здоровье транспортов и счётчики ошибок плагинов и сериалайзеров. Используйте данные в health-check или дашбордах.

## Отчётность транспортов

Реализуйте getDiagnostics() внутри транспорта, чтобы возвращать дополнительные сведения (очереди, повторы, задержки). Коннектор объединяет их с внутренними метриками.

## Чек-лист расследования

- Повторяющиеся предупреждения транспорта — проверьте сеть или авторизацию.
- Растущие счётчики сериалайзеров — пересмотрите новые поля в логах.
- Ошибки плагинов — добавьте проверки на отсутствие ожидаемых данных.
